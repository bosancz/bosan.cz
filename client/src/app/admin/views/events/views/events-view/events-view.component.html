<div class="row">
  <div class="col-12 col-md-10">
    <h2>
      {{event?.name}}
      <event-status-badge [event]="event" class="align-top"></event-status-badge>
    </h2>
  </div>
  <div class="col-12 col-md-2 buttons my-3 my-md-0">

    <div *ngIf="event" class="dropdown text-right actions" dropdown>

      <button id="button-basic" dropdownToggle type="button" class="btn btn-primary dropdown-toggle w-100">Akce<span class="caret"></span></button>

      <div class="dropdown-menu" *dropdownMenu>
        <a *ngIf="!editing" [class.disabled]="!editable" class="dropdown-item" (click)="editing = true">Upravit</a>
        <a *ngIf="editing" class="dropdown-item" (click)="cancelEdit()">Zrušit úpravy</a>
        <a *ngIf="editing" class="dropdown-item" (click)="saveEvent()">Uložit</a>

        <div class="dropdown-divider"></div>

        <a *ngIf="event._actions?.submit" [class.disabled]="!event._actions?.submit.allowed" class="dropdown-item" (click)="eventAction('submit')">Ke schválení</a>
        <a *ngIf="event._actions?.publish" [class.disabled]="!event._actions?.publish.allowed" class="dropdown-item" (click)="eventAction('publish')">Do programu</a>
        <a *ngIf="event._actions?.announce" [class.disabled]="!event._actions?.announce.allowed" class="dropdown-item" (click)="eventAction('submit')">Poslat ohlášku</a>
        <a *ngIf="event._actions?.finalize" [class.disabled]="!event._actions?.finalize.allowed" class="dropdown-item" (click)="eventAction('submit')">Uzavřít</a>
        <a *ngIf="event._actions?.reject" [class.disabled]="!event._actions?.reject.allowed" class="dropdown-item" (click)="eventAction('reject')">Vrátit vedoucím k úpravám</a>
        <a *ngIf="event._actions?.unpublish" [class.disabled]="!event._actions?.unpublish.allowed" class="dropdown-item" (click)="eventAction('unpublish')">Odebrat z programu</a>
        <a *ngIf="event._actions?.cancel" [class.disabled]="!event._actions?.cancel.allowed" class="dropdown-item text-danger" (click)="eventAction('cancel')">Zrušit</a>
        <a *ngIf="event._actions?.uncancel" [class.disabled]="!event._actions?.uncancel.allowed" class="dropdown-item" (click)="eventAction('uncancel')">Odzrušit</a>
        <a [class.disabled]="!event._links?.self?.allowed.DELETE" class="dropdown-item text-danger" (click)="deleteEvent()">Smazat</a>

        <div class="dropdown-divider"></div>

        <a class="dropdown-item" [href]="getAnnouncementTemplateUrl()">Stáhnout ohlášku</a>
        <a class="dropdown-item" [href]="getAccountingTemplateUrl()">Stáhnout účtování</a>

      </div>
    </div>
  </div>


</div>

<ng-container *ngIf="!editing">
  <h4>{{[event?.dateFrom,event?.dateTill] | dateRange}}</h4>

  <p class="description multiline">{{event?.description || 'Popisek akce nevyplněn.'}}</p>
</ng-container>

<form *ngIf="event && editing">

  <div class="form-group">
    <label>Název akce</label>
    <input type="text" name="name" [(ngModel)]="event.name" class="form-control">
  </div>

  <div class="row">
    <div class="col-6 col-md-3">
      <input type="date" ame="dateFrom" [(ngModel)]="event.dateFrom" class="form-control" required>
    </div>
    <div class="col-6 col-md-3">
      <input type="date" ame="dateTill" [(ngModel)]="event.dateTill" class="form-control" required>
    </div>
  </div>

  <div class="mt-3">
    <textarea class="form-control" name="description" rows="3" [(ngModel)]="event.description" textcheck #descriptionCheck="textcheck"></textarea>
    <p class="text-danger">{{ descriptionCheck.warnings ? descriptionCheck.warnings.join(" ") : ""}}</p>
  </div>



  <div class="form-group">
    <label>Místo</label>
    <input type="text" name="place" [(ngModel)]="event.place" class="form-control" placeholder="Dno pytle">
  </div>

  <div class="form-row" ngModelGroup="meeting">
    <div class="form-group col-md-6">
      <label>Sraz</label>
      <input type="text" name="start" [(ngModel)]="event.meeting.start" class="form-control" placeholder="17:00, u Bilba doma">
    </div>
    <div class="form-group col-md-6">
      <label>Konec</label>
      <input type="text" name="end" [(ngModel)]="event.meeting.end" class="form-control" placeholder="3:00, tamtéž">
    </div>
  </div>

  <div class="form-group">
    <label>Oddíly</label>
    <groups-select [ngModel]="event.groups" name="groups" [readonly]="!editable"></groups-select>
  </div>

  <div class="mt-4">
    <div class="d-inline-block mr-3">
      <event-subtype-selector [ngModel]="event?.subtype" (ngModelChange)="saveEvent({subtype:$event})" [readonly]="!editable"></event-subtype-selector>
    </div>
    <!--<event-type-selector [ngModel]="event?.type" (ngModelChange)="saveEvent({type:$event})" [readonly]="!editable"></event-type-selector>-->
  </div>
</form>

<h4 class="mt-5">Přihláška</h4>
<event-registration [event]="event" (change)="loadEvent(event._id)" [readonly]="!editable"></event-registration>

<h4 class="mt-5">Vedoucí akce</h4>
<event-attendees-list *ngIf="event" [ngModel]="event.leaders" (ngModelChange)="saveEvent({leaders:$event})" [event]="event" [readonly]="!editable"></event-attendees-list>

<h4 class="mt-5">Účastníci</h4>
<event-attendees-list *ngIf="event" [ngModel]="event.attendees" (ngModelChange)="saveEvent({attendees:$event})" [event]="event" [readonly]="!editable"></event-attendees-list>


<!--<event-age-histogram *ngIf="event" [event]="event"></event-age-histogram>-->


<h4 class="mt-5">Účtování</h4>
<event-expenses-table [ngModel]="event?.expenses" (ngModelChange)="saveEvent({expenses:$event})" [days]="days - 1" [persons]="(event?.attendees?.length || 0) + (event?.leaders?.length || 0)" [readonly]="!editable"></event-expenses-table>

<!--
<h4 class="mt-5">Report</h4>
<div [innerHTML]="event?.report || '<p>Report je prázdný.</p>'"></div>
-->